

Яндекс.Станция Макс. Три истории про новое устройство с Алисой / Habr


               25  November  2020 at 15:59  Яндекс.Станция Макс. Три истории про новое устройство с Алисой Яндекс corporate blog Gadgets Computer hardware Artificial Intelligence Smart House       У нас есть ежегодная традиция: рассказывать читателям Хабра о разработке нового устройства с Алисой. 2020 год, конечно, разрушил многие планы, но эту традицию сохранить удалось. Сегодня на YaC 2020 мы показали нашу новую колонку — Яндекс.Станцию Макс. Это не замена Станции или Станции Мини, а новая, старшая модель в семействе умных колонок Яндекса. В ней мы не просто поддержали более требовательные к железу возможности, но и сознательно отказались от некоторых компромиссов. В результате устройство, которое на этапе идеи должно было отличаться от Станции лишь в нескольких элементах, оказалось не похоже на неё примерно во всём, кроме внешнего вида. Зачем и как мы этого добились — рассказываю в трёх историях. В качестве бонуса вы узнаете о непростой работе с производством в условиях пандемии. История про звукВ посте про создание Яндекс.Станции мы рассказывали о том, как искали компромисс между воспроизведением звука и распознаванием голоса. У производителей обычной акустики такой задачи нет. Для нас же важно не только хорошо звучать, но и понимать речь человека. Поэтому в Яндекс.Станции мы пошли на достаточно необычное решение. Мы перенаправили воспроизведение средних частот на вуфер, который, в свою очередь, был направлен в противоположную от микрофонов сторону.Акустика в Яндекс.СтанцииБлагодаря этому мы уменьшили искажение человеческой речи, которая преимущественно состоит из тех же самых средних частот.В более старшей Яндекс.Станции Макс у нас появилась возможность переосмыслить это решение. И на то было как минимум две причины.  Причина первая. Мы отказались от предыдущих, аналоговых микрофонов и заменили их цифровыми Knowles Everest. Важно сразу сказать, что противопоставление качества аналоговых и цифровых микрофонов само по себе лишено смысла, если, конечно, у вас нет цели погрузиться в многостраничный холивар между сторонниками противоположных точек зрения. Тем не менее наши новые микрофоны относятся к более дорогому сегменту, и, по нашему скромному мнению, это одни из лучших цифровых микрофонов для умных устройств. Они отличаются хорошей сбалансированностью: достаточно высокий уровень чувствительности одновременно с хорошим соотношением сигнал/шум и уровнем AOP (Acoustic Overload Point — это такой аналог максимального звукового давления для цифровых микрофонов). Можно найти микрофоны и с большей чувствительностью, но с низким AOP, из-за чего при высокой громкости услышать команды будет сложнее (понятно, что «слышать команду» — это комплексный процесс, на который влияет много факторов, но на уровне микрофонов мы постарались выбрать лучший вариант).Кстати, переход на цифровые микрофоны позволил нам упростить конструкцию устройства за счёт отказа от отдельных аналогово-цифровых преобразователей. В Станции их было аж пять штук. Мелочь, а приятно. Причина вторая. Технологии Яндекса в области распознавания речи и голосовой активации всё это время тоже не стояли на месте. Пожалуй, самое важное: мы отказались от моделей на базе DNN-HMM и перешли на архитектуру e2e-распознавания с использованием тяжёлых нейросетей-трансформеров. Это значит, что теперь мы не дробим речь на последовательность звуков, чтобы распознавать их по отдельности, а обучаем модель работать со всей фразой целиком. На это требуется значительно больше как вычислительных ресурсов, так и примеров для обучения, но и результат оказывается существенно лучше. Итак, новые микрофоны, прогресс в голосовых технологиях и более смелый ценовой сегмент позволили нам пересмотреть архитектуру акустики в Станции Макс. Мы добавили два новых динамика — для средних частот. Рядом с ними — фазоинверторы. Это такие акустические порты в корпусе, которые инвертируют звук с тыльной стороны динамика и выводят его на фронтальную часть, усиливая звуковое давление. Как правило, в умных колонках не используют фазоинверторы из-за экономии и стремления упростить конструкцию. Новые динамики разнесли в разные стороны корпуса, тем самым добились более объёмного звука и честного стерео для средних частот. Кроме того, это нововведение позволило нам обновить и вуфер. В Станции вуфер был сконструирован так, чтобы справляться и с басами, и с вокалом. Компромиссное решение. В Станции Макс мы добавили отдельные среднечастотные динамики, а значит, вуфер теперь можно было переориентировать исключительно на низкие частоты. Новый вуфер Станции Макс в связке с новым пассивным излучателем способен воспроизводить частоты от 45 Гц (по паспорту; по факту начинаем играть от 40 Гц).Акустика в Яндекс.Станции МаксПри этом мощность всей акустики выросла до 65 Вт. На самом деле сумма мощностей всех элементов приближается к 90 Вт, но мы сознательно ограничили потолок на уровне источника питания. Потому что лучше использовать более мощные динамики в комфортных условиях, чем вгонять в предельные режимы работы более дешёвые варианты. К тому же 65 Вт — это уже очень громко. Чтобы «раскачать» новые динамики, мы решили обновить и без того неплохие усилители, применяющиеся в Станции. В обоих случаях они от Texas Instruments, но в Станции Макс используется более свежая и мощная модель TAS5825M. В неё встроен более производительный DSP (Digital Signal Processor), который необходим для многоуровневой предобработки звука, например для функции с говорящим названием Smart Bass. Причём мы используем два таких усилителя. Первый работает по классической стереосхеме: к каждому каналу подключена пара из среднечастотного динамика и твитера. Второй — по параллельно-мостовой схеме (PBTL), то есть два канала соединены параллельно и отвечают за вуфер (запас мощности особенно важен для низких частот).Все элементы нашей новой акустики спроектированы под Станцию Макс. Даже материал мембраны и глубина её посадки. Это важно, потому что чем больше амплитуда колебаний мембраны, тем больше максимальная длина волны звука и тем более низкие частоты она может играть. Если совершить ошибку на этом этапе, то на экстремальных режимах работы мембрана может начать касаться натянутой на корпус ткани. Этой проблемы мы избежали, но вот с некоторыми другими пришлось повозиться. В Яндекс.Станции под тканью маскировались два компактных высокочастотных твитера и два пассивных излучателя. В Станции Макс и отверстий стало больше, и сами они тоже стали больше. Из-за этого мы столкнулись с проблемой, с которой раньше нам не приходилось работать. Акустическая ткань, которой обтянут корпус, имеет нехорошую тенденцию провисать над большими отверстиями. Как бы сильно вы её ни натянули, этого эффекта не избежать. Кроме того, под определёнными углами и при высокой яркости освещения отверстия становились различимы для глаз. Эту проблему мы решили просто: выбрали более плотную ткань, которая существенно снизила качество воспроизводимого звука из-за более низкой проницаемости. Шутка! Для нас было важно сохранить то звучание, которого мы так долго добивались с помощью новой акустики. Пришлось немного попотеть, но подходящее решение нашлось. Мы добавили под ткань тонкую сеть с крупной ячейкой, которая практически не влияет на акустические характеристики, но удерживает ткань от провисаний и визуально маскирует начинку корпуса от любопытных глаз. Кроме того, возможность сохранить менее плотную акустическую ткань позволила нам реализовать нашу давнюю мечту — подарить Алисе визуальный язык. Но об этом чуть позже. Ещё одна важная деталь про звук, которая относится ко всем трём моделям Станции. Мы достаточно часто встречаем пользователей, которые используют дома сразу несколько колонок. К примеру, Станция стоит у телевизора, а Станция Мини — на кухне. Теперь достаточно будет сказать: «Алиса, включи музыку везде», чтобы трек заиграл синхронно на всех ваших Станциях. Это изменение постепенно станет доступно на всех умных колонках Яндекса.История про видеоРаньше на КиноПоиске 4K-контента было немного, но теперь его становится больше. Поэтому мы хотели дать возможность владельцам 4K-телевизоров смотреть фильмы и сериалы в соответствующем качестве через колонку с Алисой. Но одним лишь бэкендом эту задачу не решить.Видео в 4К-разрешении существенно более тяжёлое, чем народное Full HD (спасибо, кэп). Чтобы оно не тормозило при загрузке, применяется более совершенный стандарт сжатия H.265, также известный как HEVC. Как вы уже догадались, в нём используются более сложные алгоритмы. Поэтому в Станции Макс мы перешли на платформу SoC Amlogic S905X2 вместо Allwinner R18. В её основе те же четыре ядра ARM Cortex-A53, но теперь они работают на большей частоте 1,8 GHz, к ним добавилась более мощная графическая подсистема Mali-G31 MP2. И, что самое важное: появилась встроенная поддержка новых кодеков, в частности HEVC 4K@60fps. Благодаря этому колонка уверенно справляется с воспроизведением 4К-контента. Оперативной памяти, кстати, тоже стало больше: 2 GB вместо 1 GB. Уметь воспроизводить контент — хорошо, но его ведь надо ещё скачать из сети. Чтобы смотреть видео в разрешении 1080p, нужна скорость в 8